#!/bin/bash
echo "[custom-init] Checking for Chrome lock files..."

# Clean up Chrome SingletonLock files which prevent startup if the previous container crashed
# The profile is typically in /config (due to linuxserver image structure)
# or /config/.config/chromium
# or /config/xdg/config/chromium

LOCKS=$(find /config -name SingletonLock -o -name SingletonCookie)

if [ -n "$LOCKS" ]; then
    echo "[custom-init] Found lock files:"
    echo "$LOCKS"
    echo "[custom-init] Removing lock files to ensure clean startup..."
    find /config -name SingletonLock -delete
    find /config -name SingletonCookie -delete
else
    echo "[custom-init] No lock files found."
fi

# Also clean audio lock if present (sometimes ALSA/Pulse leaves this)
rm -f /dev/shm/audio.lock
